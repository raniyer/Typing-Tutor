#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<time.h>
#include <unistd.h>

typedef struct report{
	float timetaken;
	float accuracy;
	struct report *next;
}report;

report *head =NULL;
int n=0;

void calculate(int ,int ,float);
void begin();
void knowmore();
void nextwork();
void choices();
void store(report *);
void sureexit();

void sureexit(){
	int c;
	printf("are you sure you want to exit: all your progress will be lost.\n(1=HOMEPAGE | 0=Exit)");
	scanf("%d", &c);
	switch(c){
		case 0: exit(5);
			break;
		case 1: choices();
			break;
		default:printf("wrong entry");
			sureexit();
	}
}

void store(report *ptr){
	if (head==NULL){
		head = ptr;
		head->next = NULL;
	}
	else{
		report *temp;
		for(temp=head; temp->next != NULL; temp=temp->next);
		temp->next = ptr;
		ptr->next = NULL;
	}
	n +=1;
}

int homepage(void){
	printf("\n\t\t\t\t\tWELCOME TO THE TYPING TUTOR!!");
	printf("\n\nHere, we will work on your typing speed make you better and more accurate typist.");
	printf("\n\nlet's start our journey to rise as the best typist of all times.");
	printf("\n\n\t\t\t\tare you ready to begin?\n");
	choices();
	
}

void freemem(){
	int i;
	for(i=0; i<n; i++){
		report *temp = head;
		head= head->next;
		free(temp);
	}
	n=0;
	printf("progress erased");
	choices();
}

void progress(){
	report *temp;
	printf("\n\nAccuracy through all your entries:");
	for (temp=head; temp!=NULL; temp = temp->next)
		printf("\t%lf", temp->accuracy);
	printf("\n\nTime taken through all your entries:");	
	for (temp=head; temp!=NULL; temp = temp->next)
		printf("\t%lf", temp->timetaken);
	choices();

}

void choices(){
	int c;
	printf("\n\npress 1 to begin.\npress 2 to view your progress.\npress 3 to erase all progress.\npress 4 to know more about our workspace.\npress 5 to exit.\n\n");
	
	scanf(" %d", &c);
	switch(c){
        	case 1: begin();
        	        break;
		case 2: progress();
			break;
		case 3: freemem();
			break;
        	case 4: knowmore();
                	break;
		case 5: sureexit();
			break;
        	default:printf("please enter a valid option");
			choices();
    	}
}

void begin(){
	int correct=0, wrong=0, i, x;
	float timetaken;
	clock_t start, end;
	char a[100], c ;
	char b[]="HELLO TYPING TUTOR";
	printf("enter the following words as it is as fast as you can:\n");
	sleep(1);
	getchar();
	printf("%s\n", b);
	start= clock();
	scanf(" %[^\n]s", a);
	end= clock();
	x = strlen(b);
	for(i=0; i<x; i++){
	        if (a[i]==b[i])
	            correct++;
	        else
	            wrong++;
	}
	timetaken = (float)(end-start)/10;
	calculate(correct, wrong, timetaken);
	nextwork();
}

void calculate(int correct,int wrong,float timetaken){
	int per;
	report *ptr;
	ptr =(report*)malloc(sizeof(report*));
	ptr->timetaken = timetaken;
	printf("Right letters: %d\n", correct);
	printf("wrong letters: %d\n", wrong);
	printf("timetaken: %lf\n", timetaken);
	ptr->accuracy = (float)(100*correct)/(correct+wrong);
	printf("accuracy: %lf", ptr->accuracy);
	printf("%%");
	printf("\n\n");
	store(ptr);
}

void knowmore(){}

void nextwork(){
	int c;
	printf("Do you want to continue?(1=yes | 2=no)");
	scanf("%d", &c);
	switch(c){
		case 1: begin();
			break;
		case 2: choices();
			break;
		default:printf("wrong input");
			nextwork();
	}
}

int main(void){
        homepage();
        return 0;
}
